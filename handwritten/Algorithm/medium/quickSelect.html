<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>å¿«é€Ÿé€‰æ‹©ç®—æ³•æ¼”ç¤º</title>
    <style>
      body {
        font-family: 'Segoe UI', sans-serif;
        max-width: 1200px;
        margin: 0 auto;
        padding: 20px;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
      }

      .container {
        background: white;
        border-radius: 15px;
        padding: 30px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
      }

      h1 {
        text-align: center;
        color: #333;
        margin-bottom: 30px;
        font-size: 2.5em;
      }

      .controls {
        display: flex;
        gap: 15px;
        margin-bottom: 30px;
        align-items: center;
        flex-wrap: wrap;
      }

      input,
      button {
        padding: 10px 15px;
        border: 2px solid #ddd;
        border-radius: 8px;
        font-size: 16px;
      }

      button {
        background: linear-gradient(45deg, #667eea, #764ba2);
        color: white;
        border: none;
        cursor: pointer;
        transition: transform 0.2s;
      }

      button:hover {
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
      }

      .array-container {
        margin: 20px 0;
        min-height: 80px;
      }

      .array-title {
        font-weight: bold;
        margin-bottom: 10px;
        font-size: 18px;
        color: #333;
      }

      .array-display {
        display: flex;
        gap: 5px;
        flex-wrap: wrap;
        margin-bottom: 15px;
      }

      .array-element {
        width: 50px;
        height: 50px;
        display: flex;
        align-items: center;
        justify-content: center;
        border: 2px solid #333;
        border-radius: 8px;
        font-weight: bold;
        font-size: 16px;
        transition: all 0.3s ease;
      }

      .pivot {
        background-color: #ff6b6b;
        color: white;
        transform: scale(1.1);
      }

      .left-part {
        background-color: #51cf66;
        color: white;
      }

      .right-part {
        background-color: #339af0;
        color: white;
      }

      .target {
        background-color: #ffd43b;
        color: #333;
        border: 3px solid #ff6b6b;
        animation: pulse 1s infinite;
      }

      @keyframes pulse {
        0% {
          transform: scale(1);
        }
        50% {
          transform: scale(1.05);
        }
        100% {
          transform: scale(1);
        }
      }

      .step-info {
        background: #f8f9fa;
        padding: 20px;
        border-radius: 10px;
        margin: 20px 0;
        border-left: 5px solid #667eea;
      }

      .step-info h3 {
        margin-top: 0;
        color: #667eea;
      }

      .result {
        background: linear-gradient(45deg, #51cf66, #40c057);
        color: white;
        padding: 20px;
        border-radius: 10px;
        text-align: center;
        font-size: 20px;
        font-weight: bold;
        margin-top: 20px;
      }

      .code-section {
        background: #f8f9fa;
        padding: 20px;
        border-radius: 10px;
        margin: 20px 0;
        font-family: 'Courier New', monospace;
        overflow-x: auto;
      }

      .algorithm-explanation {
        background: #e3f2fd;
        padding: 20px;
        border-radius: 10px;
        margin: 20px 0;
        border-left: 5px solid #2196f3;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>ğŸš€ å¿«é€Ÿé€‰æ‹©ç®—æ³•å¯è§†åŒ–</h1>

      <div class="controls">
        <label
          >æ•°ç»„:
          <input type="text" id="arrayInput" value="3,6,8,10,1,2,1" placeholder="ç”¨é€—å·åˆ†éš”æ•°å­—" />
        </label>
        <label>æ‰¾ç¬¬ <input type="number" id="kInput" value="4" min="1" style="width: 60px" /> å¤§çš„å…ƒç´  </label>
        <button onclick="startDemo()">å¼€å§‹æ¼”ç¤º</button>
        <button onclick="reset()">é‡ç½®</button>
      </div>

      <div class="algorithm-explanation">
        <h3>ç®—æ³•åŸç†</h3>
        <p><strong>å¿«é€Ÿé€‰æ‹©ç®—æ³•</strong>åŸºäºå¿«é€Ÿæ’åºçš„åˆ†åŒºæ€æƒ³ï¼š</p>
        <ol>
          <li><strong>é€‰æ‹©åŸºå‡†å…ƒç´ (pivot)</strong>ï¼šé€šå¸¸é€‰æ‹©ç¬¬ä¸€ä¸ªå…ƒç´ æˆ–éšæœºå…ƒç´ </li>
          <li><strong>åˆ†åŒºæ“ä½œ</strong>ï¼šå°†æ•°ç»„åˆ†ä¸ºä¸‰éƒ¨åˆ†ï¼šå°äºpivotçš„ã€ç­‰äºpivotçš„ã€å¤§äºpivotçš„</li>
          <li><strong>åˆ¤æ–­ä½ç½®</strong>ï¼šæ ¹æ®pivotçš„æœ€ç»ˆä½ç½®å†³å®šåœ¨å“ªéƒ¨åˆ†ç»§ç»­æŸ¥æ‰¾</li>
          <li><strong>é€’å½’æŸ¥æ‰¾</strong>ï¼šåªå¯¹åŒ…å«ç›®æ ‡å…ƒç´ çš„éƒ¨åˆ†è¿›è¡Œé€’å½’</li>
        </ol>
        <p><strong>æ—¶é—´å¤æ‚åº¦</strong>ï¼šå¹³å‡O(n)ï¼Œæœ€åO(nÂ²) | <strong>ç©ºé—´å¤æ‚åº¦</strong>ï¼šO(1)</p>
      </div>

      <div id="stepContainer"></div>

      <div class="code-section">
        <h3>JavaScriptå®ç°ä»£ç </h3>
        <pre><code>function quickSelect(nums, k) {
    function partition(left, right, kSmallest) {
        // 1. é€‰æ‹©pivot (è¿™é‡Œé€‰æ‹©ç¬¬ä¸€ä¸ªå…ƒç´ )
        const pivot = nums[left];
        let i = left + 1, j = right;
        
        // 2. åŒæŒ‡é’ˆåˆ†åŒº
        while (i <= j) {
            if (nums[i] < pivot && nums[j] > pivot) {
                [nums[i], nums[j]] = [nums[j], nums[i]];
                i++; j--;
            }
            if (nums[i] >= pivot) i++;
            if (nums[j] <= pivot) j--;
        }
        
        // 3. å°†pivotæ”¾åˆ°æ­£ç¡®ä½ç½®
        [nums[left], nums[j]] = [nums[j], nums[left]];
        
        // 4. é€’å½’æŸ¥æ‰¾
        if (j === kSmallest) return nums[j];
        else if (j < kSmallest) return partition(j + 1, right, kSmallest);
        else return partition(left, j - 1, kSmallest);
    }
    
    // ç¬¬kå¤§ = ç¬¬(n-k+1)å°
    return partition(0, nums.length - 1, nums.length - k);
}</code></pre>
      </div>
    </div>

    <script>
      let originalArray = [];
      let currentStep = 0;
      let steps = [];

      function parseArray() {
        const input = document.getElementById('arrayInput').value;
        return input
          .split(',')
          .map((num) => parseInt(num.trim()))
          .filter((num) => !isNaN(num));
      }

      function startDemo() {
        originalArray = parseArray();
        const k = parseInt(document.getElementById('kInput').value);

        if (originalArray.length === 0 || k < 1 || k > originalArray.length) {
          alert('è¯·è¾“å…¥æœ‰æ•ˆçš„æ•°ç»„å’Œkå€¼ï¼');
          return;
        }

        steps = [];
        currentStep = 0;

        // æ¨¡æ‹Ÿå¿«é€Ÿé€‰æ‹©è¿‡ç¨‹
        const nums = [...originalArray];
        quickSelectWithSteps(nums, 0, nums.length - 1, nums.length - k, k);

        displayStep();
      }

      function quickSelectWithSteps(nums, left, right, targetIndex, k) {
        if (left >= right) {
          steps.push({
            array: [...nums],
            left,
            right,
            pivot: -1,
            description: `æ‰¾åˆ°ç»“æœï¼šç¬¬${k}å¤§çš„å…ƒç´ æ˜¯ ${nums[targetIndex]}`,
            result: nums[targetIndex],
            targetIndex,
          });
          return nums[targetIndex];
        }

        // é€‰æ‹©pivot
        const pivotIndex = left;
        const pivot = nums[pivotIndex];

        steps.push({
          array: [...nums],
          left,
          right,
          pivot: pivotIndex,
          description: `æ­¥éª¤ ${steps.length + 1}: é€‰æ‹©pivot = ${pivot}ï¼ŒèŒƒå›´ [${left}, ${right}]`,
          phase: 'pivot',
        });

        // åˆ†åŒºæ“ä½œ
        let i = left + 1,
          j = right;
        const partitionSteps = [];

        while (i <= j) {
          if (nums[i] < pivot && nums[j] > pivot) {
            [nums[i], nums[j]] = [nums[j], nums[i]];
            partitionSteps.push({
              array: [...nums],
              left,
              right,
              pivot: pivotIndex,
              i,
              j,
              description: `äº¤æ¢ nums[${i}]=${nums[j]} å’Œ nums[${j}]=${nums[i]}`,
            });
            i++;
            j--;
          } else {
            if (nums[i] >= pivot) i++;
            if (nums[j] <= pivot) j--;
          }
        }

        // å°†pivotæ”¾åˆ°æ­£ç¡®ä½ç½®
        [nums[left], nums[j]] = [nums[j], nums[left]];

        steps.push({
          array: [...nums],
          left,
          right,
          pivot: j,
          description: `åˆ†åŒºå®Œæˆï¼špivot ${pivot} çš„æœ€ç»ˆä½ç½®æ˜¯ ${j}`,
          phase: 'partitioned',
          pivotFinalPos: j,
        });

        // åˆ¤æ–­ä¸‹ä¸€æ­¥
        if (j === targetIndex) {
          steps.push({
            array: [...nums],
            left,
            right,
            pivot: j,
            description: `æ‰¾åˆ°ç›®æ ‡ï¼ç¬¬${k}å¤§çš„å…ƒç´ æ˜¯ ${nums[j]}`,
            result: nums[j],
            targetIndex: j,
          });
          return nums[j];
        } else if (j < targetIndex) {
          steps.push({
            array: [...nums],
            left,
            right,
            pivot: j,
            description: `ç›®æ ‡åœ¨å³åŠéƒ¨åˆ†ï¼Œç»§ç»­åœ¨ [${j + 1}, ${right}] ä¸­æŸ¥æ‰¾`,
            phase: 'go_right',
            nextLeft: j + 1,
            nextRight: right,
          });
          return quickSelectWithSteps(nums, j + 1, right, targetIndex, k);
        } else {
          steps.push({
            array: [...nums],
            left,
            right,
            pivot: j,
            description: `ç›®æ ‡åœ¨å·¦åŠéƒ¨åˆ†ï¼Œç»§ç»­åœ¨ [${left}, ${j - 1}] ä¸­æŸ¥æ‰¾`,
            phase: 'go_left',
            nextLeft: left,
            nextRight: j - 1,
          });
          return quickSelectWithSteps(nums, left, j - 1, targetIndex, k);
        }
      }

      function displayStep() {
        const container = document.getElementById('stepContainer');
        container.innerHTML = '';

        if (currentStep >= steps.length) return;

        const step = steps[currentStep];

        const stepDiv = document.createElement('div');
        stepDiv.className = 'step-info';

        stepDiv.innerHTML = `
                <h3>${step.description}</h3>
                <div class="array-display">
                    ${step.array
                      .map((num, index) => {
                        let className = 'array-element';
                        if (index === step.pivot && step.phase !== 'partitioned') {
                          className += ' pivot';
                        } else if (step.result !== undefined && index === step.targetIndex) {
                          className += ' target';
                        } else if (step.phase === 'partitioned') {
                          if (index < step.pivotFinalPos) className += ' left-part';
                          else if (index > step.pivotFinalPos) className += ' right-part';
                          else className += ' pivot';
                        }
                        return `<div class="${className}">${num}</div>`;
                      })
                      .join('')}
                </div>
                ${
                  step.result !== undefined
                    ? `<div class="result">ğŸ‰ æ‰¾åˆ°ç­”æ¡ˆï¼š${step.result}</div>`
                    : `<button onclick="nextStep()" style="margin-top: 10px;">ä¸‹ä¸€æ­¥</button>`
                }
            `;

        container.appendChild(stepDiv);
      }

      function nextStep() {
        currentStep++;
        displayStep();
      }

      function reset() {
        document.getElementById('stepContainer').innerHTML = '';
        currentStep = 0;
        steps = [];
      }

      // åˆå§‹åŒ–
      startDemo();
    </script>
  </body>
</html>
